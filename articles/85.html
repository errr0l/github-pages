<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>剖析0.1+0.2不等于0.3的原因 - 小埃的个人博客</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/mobile.css">
    <link rel="stylesheet" href="../css/theme-light.css">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?d1fc0144cbb354a3f8442b7ba568bc2f";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();

        window.addEventListener('DOMContentLoaded', () => {
            let headerEle = document.getElementById('header');
            let eleHeight = headerEle.offsetHeight;
            let lastScrollTop = 0;
            let topAnchor = 0; // 某个方向的锚点
            let downAnchor = 0;
            let stylTop = "-" + eleHeight + "px";
            let stylTop2 = "0";
            let threshold = 180;
            function headerEleVisibleHandler() {
                let scrollTop = document.documentElement.scrollTop;
                // 向下滚动
                if (scrollTop > lastScrollTop) {
                    if (downAnchor !== 0) {
                        downAnchor = 0;
                    }
                    if (topAnchor === 0) {
                        topAnchor = scrollTop;
                    }
                    if ((scrollTop > threshold || scrollTop - topAnchor > threshold) && headerEle.style.top !== stylTop) {
                        headerEle.style.top =  stylTop;
                    }
                }
                // 向上
                else {
                    if (topAnchor !== 0) {
                        topAnchor = 0;
                    }
                    if (downAnchor === 0) {
                        downAnchor = scrollTop;
                    }
                    if ((scrollTop + threshold > downAnchor) && headerEle.style.top === stylTop) {
                        headerEle.style.top = stylTop2;
                    }
                }
                lastScrollTop = scrollTop;
            }

            function throttleWrapper(fn, options) {
                if (!options) {
                    options = {};
                }
                let timer = null;
                const { timeout } = options;

                const _setTimeout = () => {
                    timer = window.setTimeout(() => {
                        window.clearTimeout(timer);
                        timer = null;
                    }, timeout);
                    return timer;
                }

                return function (...args) {
                    if (timer) {
                        return;
                    }
                    timer = -1;
                    let result = fn.apply(this, args);
                    _setTimeout();
                    return result;
                }
            }
            headerEleVisibleHandler = throttleWrapper(headerEleVisibleHandler, { timeout: 200 });
            window.addEventListener("scroll", headerEleVisibleHandler);
        });
    </script>
        <meta name="keywords" content="js,二进制">
        <meta name="description" content="剖析0.1+0.2不等于0.3的原因；相信每一位写js代码者都曾遇到或看到过0.1+0.2不等于0.3的问题，对于习惯了十进制的我们来说，是非常违反常识的存在，令人困惑不已。这其实一个关于二进制的问题，以前倒是写过一篇相关的文章...">
    <link rel="stylesheet" href="../css/article.css">
    <link rel="stylesheet" href="../css/markdown/github-markdown.css">
    <link rel="stylesheet" href="../css/markdown/github-markdown-light.css">
    <link rel="stylesheet" href="../css/gittalk-cover.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</head>
<body>
<div id="app">
    <div id="header">
    <div id="bar">
        <div class="container mg-0-auto d-f pos-r">
            <div class="logo">
                <a href="../" class="nav-link" style="margin-right: 10px;">
                    <img src="../image/portal/logo.jpg" alt="小埃的个人博客">
                </a>
            </div>
            <div class="right">
                <ul class="nav f-l">
                        <li class="nav-item">
                            <a href="../index.html" class="nav-link active">
                                <span>首页</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="../category.html" class="nav-link ">
                                <span>分类</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="../about.html" class="nav-link ">
                                <span>关于</span>
                            </a>
                        </li>
                </ul>
                <div class="eb-title">
                    小埃的个人博客
                </div>
                    <div id="search">
                        <input type="text" id="search-input" data-prefix="../" placeholder="搜索" autocomplete="off" />
                        <span class="search-icon t-a">
                            <img class="el-icon-search" src="../image/portal/search.png" width="16" height="16">
                        </span>
                        <div id="search-result">
                            <input type="text" class="input-1" id="search-input-2" data-prefix="../" placeholder="请输入" autocomplete="off" />
                            <div class="content">
                            </div>
                            <div class="arrow"></div>
                        </div>
                    </div>

                <div class="eb-menu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                    </svg>
                </div>
            </div>
            <div id="sc-box">
                <div class="wrapper">
                        <div class="side-card b-s-1 mg-b-10">
                            <div class="wrapper">
                                <h2 class="item title">
                                    <span>相关文章</span>
                                </h2>
                                <div class="item content">
                                        <div class="item1 ">
                                            <a href="../articles/80.html">
                                                    【猿人学】jsvmp洞察先机逆向
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/77.html">
                                                    【推特】Webpack逆向
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/76.html">
                                                    js实现监听单页面应用url的办法
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/70.html">
                                                    为静态站点添加目录功能
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/66.html">
                                                    关于nodejs使用相对路径读取文件的问题
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/55.html">
                                                    解耦在js中的应用
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/22.html">
                                                    为静态站点添加搜索功能
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/19.html">
                                                    为vue单页面应用添加提示保存功能
                                            </a>
                                        </div>
                                        <div class="item1 ">
                                            <a href="../articles/15.html">
                                                    兼容部署在Github Pages与其他服务器的应用引入资源的解决方案
                                            </a>
                                        </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div id="main">
        <div class="container mg-0-auto pd-t-10">
            <div class="wrapper">
                <article class="mg-b-20">
                    <div class="markdown-body">
                        <div class="title">剖析0.1+0.2不等于0.3的原因</div>
                        <div class="item meta mg-b-10">
                            <span class="author">由<a href="javascript:void(0);">errol</a>发表于<a href="#">2025-10-03</a></span>
                            <span>|</span>
                            <span class="time">
                            分类为
                            <a href="../categories/1.html">编程</a></span>
                            <span>|</span>
                            <span class="tags">
                                标签为<a href="javascript:void(0);">js</a>、<a href="javascript:void(0);">二进制</a>
                            </span>
                        </div>
                        <div class="content">
                            <p>相信每一位写js代码者都曾遇到或看到过0.1+0.2不等于0.3的问题，对于习惯了十进制的我们来说，是非常违反常识的存在，令人困惑不已。</p>
<p><img src="../image/portal/loading.gif" alt="image" data-src="../image/portal/202510/49fe3050f73b4c88a3557510412b3cd3-42DE6D066DCC0D0324A60741943FDA6D.png?project=easyblog" /></p>
<p>图1 0.1+0.2 != 0.3</p>
<p>这其实一个关于二进制的问题，以前倒是写过一篇相关的文章，但现在已经忘得差不多了... 没办法，尽是一些平时根本不会用到的东西，故起笔这篇文章，当做复习知识点。</p>
<p><strong>主要的原因是，有一些小数，无法使用二进制来精确地表示</strong>，如0.1，其底层二进制表示为0.0001100110011…，此时会导致<code>精度丢失</code>，本质上与在十进制中无法精确表示一些分数一样，如1/3。</p>
<p>一般情况下，编程语言默认都遵循<a href="https://baike.baidu.com/item/IEEE%20754/3869922">IEEE 754二进制浮点数算术标准</a>，所以都会存在相同的问题，而不仅仅为js独有。</p>
<p>顺便一提，即使转为整数计算，如<code>(100+200)/1000</code>，实际上也没解决问题。</p>
<p>虽然运行该表达式时，结果确实是0.3，也等于0.3，但其实是js&quot;美化&quot;了的结果，js引擎觉得你想要的应该是十进制里的0.3(有限小数)，而不是二进制的0.3(无限小数)，于是帮你抹去零头。</p>
<p><img src="../image/portal/loading.gif" alt="image" data-src="../image/portal/202510/7538d0371cd24414b5b74f77e2da7e61-673494325FAA38E0485008B3E9F4EC5E.png?project=easyblog" /></p>
<p>图1 (100+200)/1000 = 0.3?</p>
<blockquote>
<p>0.3的二进制表示为: 0.01001100110011001100110011001100110011001100110011001100110011...</p>
</blockquote>
<p>有且仅有1是小数的精确倍数时，才是准确的，如：</p>
<p><code>(0.25 + 0.5) === 0.75 // true</code></p>
<p>因为0.25和0.5都可以使用二进制精确地表示，分别是：<code>0.01</code>和<code>0.1</code>，不是无尽的数，不会发生精度丢失的问题。</p>
<p>以js为例，浮点数使用64位8字节表示，其<strong>基本的二进制表示结构为：符号位(1) + 指数(11) + 有效数字(52)</strong>。</p>
<p>其中，指数是无符号整数，因此需要使用<strong>偏移量</strong>来表示负数，且IEEE 754有两个特殊指数值，0和2047，前者表示0或非规格化数，后者表示Infinity或NaN，所以实际上可用的只有1-2046。为了保持对称(相对对称，保持以0为基准，往前是负数，往后是正数)，也就调出<code>2023</code>这个合适的偏移量。</p>
<pre><code class="language-text">最小：1 - 1023 = -1022

最小正正规数：≈ 2⁻¹⁰²² ≈ 2.2 × 10⁻³⁰⁸

最大：2046 - 1023 = +1023

最大数：≈ 2¹⁰²³ ≈ 8.9 × 10³⁰⁷
</code></pre>
<p>以0.1为例，转为一个二进制形式：</p>
<blockquote>
<p>0.000110011001100110011001100110011001100110011001100110011001100110011001100110011001100110011</p>
</blockquote>
<p>使用科学计数法表示为：</p>
<blockquote>
<p>1.10011001100110011001100110011001100110011001100110011001100110011001100110011001100110011 x 2 ^ -4</p>
</blockquote>
<p>然后截取52位作为存储的尾数，第53位用于决定是否进位，而由于第53位是1，因此需要对第52位进位，所以最终就是：</p>
<blockquote>
<p>1.1001100110011001100110011001100110011001100110011010 x 2 ^ -4</p>
</blockquote>
<p><em>注意，在存储时，因为前导1是固定不变的，所以无需存储，而只记录小数部分</em></p>
<p>所以，0.1的符号位是<code>0</code>(正数)，指数为<code>-4 + 1023</code>，尾数是<code>1001100110011001100110011001100110011001100110011010</code>。</p>
<p>以此类推，0.2为：</p>
<blockquote>
<p>1.1001100110011001100110011001100110011001100110011010 x 2 ^ -3</p>
</blockquote>
<p>符号位为<code>0</code>，指数为<code>-3 + 1023</code>，尾数为：<code>1001100110011001100110011001100110011001100110011010</code>。</p>
<p>将二者进行相加，也就是<code>0.1 + 0.2</code>的算数表达式：</p>
<p>对齐指数后操作。</p>
<pre><code class="language-text">  0.1100110011001100110011001100110011001100110011001101   × 2 ^ -3 
+ 1.1001100110011001100110011001100110011001100110011010   × 2 ^ -3  
-------------------------------------------------------------------
= 10.0110011001100110011001100110011001100110011001100111  × 2 ^ -3
= 1.00110011001100110011001100110011001100110011001100111  × 2 ^ -2
</code></pre>
<p>在将其转为十进制：</p>
<pre><code class="language-text"># 可以转为小数后再使用权重相加法。

0.0100110011001100110011001100110011001100110011001100111

0 + 0 + 1 x 2 ^ -2 + 0 + 0 + 1 x 2 ^ -5 + 1 x 2 ^ -6 + 0 + 0 + 1 x 2 ^ -9 + 1 x 2 ^ -10...
</code></pre>
<p>当然，这样手动计算也未免太繁琐，还容易出错，因此可根据该逻辑设计算法：</p>
<pre><code class="language-js">function binaryStringToDecimal(binaryStr) {
    // 分割整数部分和小数部分
    const parts = binaryStr.split('.');
    const integerPart = parts[0];
    const fractionalPart = parts[1] || '';

    let decimal = 0;

    // 1. 转换整数部分
    if (integerPart !== '0' &amp;&amp; integerPart !== '') {
        decimal += parseInt(integerPart, 2);
    }
    // 2. 转换小数部分
    for (let i = 0; i &lt; fractionalPart.length; i++) {
        if (fractionalPart[i] === '1') {
            decimal += Math.pow(2, -(i + 1));  // 2⁻¹, 2⁻², 2⁻³, ...
        }
    }
    return decimal;
}
</code></pre>
<p>调用方法：</p>
<p><img src="../image/portal/loading.gif" alt="image" data-src="../image/portal/202510/12d37b5174f74cac8f114d2e0f4be46a-CB1270C4F58CE21043381268029E7CAA.png?project=easyblog" /></p>
<p>图3 方法调用结果</p>
<p>计算得出的结果就是精确的<code>0.30000000000000004</code>，与<code>0.1 + 0.2</code>相等(废话)。</p>
<p>以上便是<code>0.1+0.2不等于0.3</code>问题的猫咪。</p>
<p>在实际项目中，如果有必要的话，可以使用精确数值类型，Decimal，可以达到精确的需求。</p>
<pre><code class="language-js">const Decimal = require('decimal.js');
let a = new Decimal(0.1);
let b = new Decimal(0.2);
let sum = a.plus(b);

console.log(sum.equals(0.3)); // true
</code></pre>
<p>大致上，内部是使用整数来表示小数，避免小数运算。初始化时，将小数解析为<code>整数部分</code>和<code>指数部分</code>，如0.1，整数为1，指数为-1，使用科学计数法表示为：1 * 10 ^ -1。</p>
<p>当然，事实上，除非与金融行业相关，否则一般不会要求绝对精确，虽然不精确，但也是一个相当接近的值，所以可以采用截取小数的暴力方式。</p>

                        </div>
                    </div>
                </article>
                <div class="comment-wrap">
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
                        <div id="gitalk-container"></div>
                        <script>
                            const gitalk = new Gitalk({
                                clientID: 'ae1422e500a8b19fb1fc',
                                clientSecret: '9f387db6a84a4945cdf5dc743c16ce25fdef6b76',
                                repo: 'github-pages',      // The repository of store comments,
                                owner: 'errr0l',
                                admin: ['errr0l'],
                                id: location.pathname,      // Ensure uniqueness and length less than 50
                                distractionFreeMode: false  // Facebook-like distraction free mode
                            });
                            gitalk.render('gitalk-container');
                        </script>
                </div>
            </div>
        </div>
    </div>
    <div class="back">返回</div>
</div>
    <script src="../js/data.js"></script>
    <script src="../js/lazy.js"></script>
    <script src="../js/search.js"></script>
    <script src="../js/menu.js"></script>
<script src="../js/toc.js"></script>
<script src="../js/caption-setter.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.7/viewer.min.js"></script>
<script>
    let back = document.querySelector(".back");
    back.addEventListener("click", function () {
        window.history.go(-1);
    });
    const viewer = new Viewer(document.querySelector('.markdown-body .content'), {
        toolbar: {
            zoomIn: 4,
            zoomOut: 4,
            oneToOne: 4,
            reset: 0,
            prev: 4,
            play: 0,
            next: 4,
            rotateLeft: 0,
            rotateRight: 0,
            flipHorizontal: 0,
            flipVertical: 0,
        },
    });
</script>
</body>
</html>